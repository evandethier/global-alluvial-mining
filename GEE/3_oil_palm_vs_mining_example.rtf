{\rtf1\ansi\ansicpg1252\cocoartf2639
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red255\green255\blue255;\red25\green25\blue25;
\red102\green0\blue145;\red50\green133\blue2;\red57\green112\blue235;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c100000\c100000\c100000;\cssrgb\c12941\c12941\c12941;
\cssrgb\c48235\c12157\c63529;\cssrgb\c23922\c58039\c0;\cssrgb\c28235\c53333\c93725;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf2 https://code.earthengine.google.com/?scriptPath=users%2Fedethier%2Fmining%3A3_oil_palm_vs_mining_example\
\
//// Calculate percent of watershed area used for oil palm cultivation ////\
// Evan Dethier\
// 2022\
\
//// 1. Import data ////\
// Import the dataset; a collection of composite granules from 2019.\
var dataset = ee.ImageCollection('BIOPAMA/GlobalOilPalm/v1');\
\
// MERIT Hydro image\
var merit = ee.Image("MERIT/Hydro/v1_0_1")\
var width = merit.select('wth')\
\
\pard\pardeftab720\partightenfactor0
\cf2 \cb3 \expnd0\expndtw0\kerning0
var kampar_kanan = /* color: #d63000 */ee.Geometry.Polygon( [[[101.64342780879664, 0.23466438028489606], [101.48824592403102, 0.2827290744895676], [101.35229011348414, 0.2827290744895676], [101.2726392345779, 0.26899632354030467], [101.22182746699977, 0.22505142054451402], [101.1078443127029, 0.2593833886342025], [101.05977912715602, 0.29371526359251726], [101.02132697871852, 0.2813558001125332], [100.9705152111404, 0.22505142054451402], [100.91833015254664, 0.20857204640066898], [100.85889905635275, 0.1784085611883314], [100.80534070674338, 0.13240348262692436], [100.78336805049338, 0.09257812073273348], [100.78336805049338, 0.07747193623772722], [100.81014722529807, 0.06030581101442813], [100.85409253779807, 0.043139680377888595], [100.84997266475119, 0.0033142449989155727], [100.83280652705588, -0.019345056389495775], [100.81014722529807, -0.03307796507583638], [100.78611463252463, -0.01728511997141433], [100.762768685259, -0.029644738051584064], [100.762768685259, -0.05917048569251524], [100.7572755211965, -0.10380239743398546], [100.76620191279807, -0.16148046309559594], [100.76963514033713, -0.2157251622998668], [100.79710096064963, -0.25074379251002715], [100.84173291865744, -0.3365733456292392], [100.89254468623557, -0.3503060090425128], [100.94060987178244, -0.37914453576488266], [100.98730176631369, -0.40111668251926064], [101.03674024287619, -0.43819454472440916], [101.07931226436057, -0.5137229390441556], [101.12325757686057, -0.5164694100833044], [101.18833956123815, -0.5556292863286563], [101.25658632279035, -0.5820742575579054], [101.30100917018538, -0.5204550184611082], [101.35859518785146, -0.5458444244520912], [101.39146188648834, -0.5224837851433722], [101.42286272581343, -0.49567405068610887], [101.46643822613687, -0.4976701751723747], [101.51376354179983, -0.4906758341550994], [101.55307286837511, -0.48842921276672113], [101.57521595272951, -0.47245005879142293], [101.55770573760532, -0.4365662844321526], [101.58036426108258, -0.3879798407595032], [101.60920165184581, -0.3677092311260763], [101.647823597149, -0.31774153188565235], [101.64799330288642, -0.28837289001593464], [101.66481209668041, -0.2653406989198988], [101.64509179406693, -0.24010312679195794], [101.60820548284109, -0.2320314284305766], [101.58112494751686, -0.18842238628042243], [101.55717647463452, -0.1520156780815679], [101.53811879444649, -0.12726722068137392], [101.50824336817905, -0.11072911041371951], [101.52017038169724, -0.07199036526889584], [101.54514363394986, -0.03737150885492987], [101.57998389108964, -0.003839345012591939], [101.5823731474866, 0.03301256363581447], [101.56185601520652, 0.051066023555328716], [101.56605811512625, 0.07735922490612808], [101.58201544051052, 0.12925898437004268], [101.64688927153996, 0.1891132334041325]]])\
var indonesia_maura_soma_region = /* color: #98ff00 */ee.Geometry.Polygon( [[[99.11511093170682, 0.5470906953324688], [99.13296371490995, 0.5161929780188464], [99.15287643463651, 0.5017739913520579], [99.19201522858182, 0.49490779599940066], [99.22497421295682, 0.5161929780188464], [99.25999313385526, 0.5450308523620482], [99.28814559967557, 0.5642560256670509], [99.30325180084745, 0.5834811354413136], [99.32591110260526, 0.5848543550798315], [99.3609300235037, 0.5773016429315], [99.37603622467557, 0.5807346951595151], [99.38496261627714, 0.6006463565767796], [99.37878280670682, 0.6260507844652922], [99.40693527252714, 0.6219311557403524], [99.44264083893339, 0.615751706630785], [99.46461349518339, 0.6191847348027638], [99.49070602448026, 0.6123186762481171], [99.5092454531912, 0.6336034287059823], [99.53602462799589, 0.6514550892707405], [99.53602462799589, 0.670679883717077], [99.52091842682401, 0.7077560578726618], [99.50581222565214, 0.7448319356497092], [99.48246627838651, 0.766116095928393], [99.45362716705839, 0.7976988477244557], [99.43028121979276, 0.8025048976382447], [99.42272811920682, 0.7805343381624025], [99.40418869049589, 0.7585636639086747], [99.37260299713651, 0.7523843915371876], [99.3499436953787, 0.7468916976353452], [99.33415084869901, 0.767489263960134], [99.31217819244901, 0.7757282628649627], [99.29226547272245, 0.7743550974902063], [99.28471237213651, 0.7434587604576364], [99.28059249908964, 0.7153085760366097], [99.29157882721464, 0.6960839602034686], [99.29432540924589, 0.6768592659994247], [99.28127914459745, 0.67548607061457], [99.26136642487089, 0.676172668355539], [99.24282699615995, 0.6645004936331848], [99.23252731354276, 0.6356632388663224], [99.21192794830839, 0.6370364451835959], [99.19270187408964, 0.6493952854772729], [99.16798263580839, 0.648708684026136], [99.14532333405057, 0.6184981293458202], [99.12678390533964, 0.5759284214592525], [99.10893112213651, 0.5621961886706789]]]);\
\cb1 \kerning1\expnd0\expndtw0 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0
\cf2 //// 2. Make oil palm cultivation composite ////\
// Select the classification band.\
var opClass = dataset.select('classification');\
\
// Mosaic all of the granules into a single image.\
var mosaic = opClass.mosaic();\
\
// Define visualization parameters.\
var classificationVis = \{\
  min: 1,\
  max: 3,\
  palette: ['ff0000','ef00ff', '696969']\
\};\
\
// Create a mask to add transparency to non-oil palm plantation class pixels.\
var mask = mosaic.neq(3);\
// mask = mask.where(mask.eq(0), 0.6);\
\
var oil_palms = mosaic.updateMask(mask)\
\
\
//// 3. Add layers to the map ////\
\
Map.addLayer(width.updateMask(width.gt(50)), \
            \{min: 50, max: 300, palette: ['black','navy','blue']\}, 'width', 0)\
Map.addLayer(merit.select('upa').gt(10).selfMask(), \{\}, 'upstream area', 0)\
            \
//// 4. Calculate watershed area at selected watersheds ////\
\
var watersheds = ee.FeatureCollection([\
  ee.Feature(kampar_kanan).set('name', 'indonesia_kampar_trib'),\
  ee.Feature(indonesia_maura_soma_region).set('name', 'indonesia_maura_soma_region'),\
  ])\
  \
var watersheds = watersheds.map(function(feature)\{\
  var area_km2 =  ee.Number(feature.geometry().area()).divide(1e6)\
  return(feature.set('area_km2', area_km2))\
\})\
\
print('watersheds', watersheds)\
\
//// 5. Calculate oil palm cultivation area ////\
var oil_palm_area = oil_palms.reduceRegions(\{\
  collection: watersheds,\
  scale: 30,\
  reducer: ee.Reducer.count()\
\}).map(function(feature)\{\
  var palm_area_km2 = ee.Number(feature.get('count')).multiply(900).divide(1e6)\
  var palm_fraction = palm_area_km2.divide(ee.Number(feature.get('area_km2')))\
  return(feature.set('palm_fraction', palm_fraction))\
\})\
\
// Print the results\
print('oil palm area', oil_palm_area)\
\
// Display the data on the map.\
Map.addLayer(oil_palms,\
             classificationVis, 'Oil palm plantation type', true);\
Map.setCenter(-3.0175, 5.2745,12);}